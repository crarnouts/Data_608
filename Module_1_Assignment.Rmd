---
title: "R Notebook"
author: "Corey Arnouts"
output:
  html_notebook: default
  html_document: default
---

**Principles of Data Visualization and Introduction to ggplot2**

I have provided you with data about the 5,000 fastest growing companies in the US, as compiled by Inc. magazine. lets read this in:

```{r, warning=FALSE, results='hide',message=FALSE}
# load libraries
library(dplyr)
library(ggplot2)
library(scales)
library(tidyr)
inc <- read.csv("https://raw.githubusercontent.com/charleyferrari/CUNY_DATA_608/master/module1/Data/inc5000_data.csv", header= TRUE)
```

And lets preview this data:

```{r}
head(inc)
```

```{r}
summary(inc)

```

Think a bit on what these summaries mean. Use the space below to add some more relevant non-visual exploratory information you think helps you understand this data:

```{r}
# Insert your code here, create more chunks as necessary
# look at the variable types
str(inc)
#look at the first few rows of data
head(inc)
```

```{r}
# summarize raw data
state_summary <- inc %>%
  group_by(State) %>%
  tally()

state_summary$Corp_count <- state_summary$n

state_revenues <- inc %>% group_by(State) %>% dplyr::summarize(Total_Revenue = sum(Revenue,na.rm = TRUE))

state_employees <- inc %>% group_by(State) %>% dplyr::summarize(Total_Employees = sum(Employees,na.rm = TRUE))

state_summary <- merge(state_summary,state_revenues)

state_summary <- merge(state_summary,state_employees)

state_summary <- state_summary %>% mutate(Revenue_Per_Emp = Total_Revenue/Total_Employees)

state_summary$n <- NULL

state_summary_with_rev_by_emp <- state_summary %>%
  arrange(desc(Corp_count))

print(state_summary_with_rev_by_emp)
```

## Question 1

Create a graph that shows the distribution of companies in the dataset by State (ie how many are in each state). There are a lot of States, so consider which axis you should use. This visualization is ultimately going to be consumed on a 'portrait' oriented screen (ie taller than wide), which should further guide your layout choices.


```{r}
df <- inc %>% 
  group_by(State) %>% 
  summarise(bizCount = n()) %>% # States act as a proxy for unique business
  arrange(desc(bizCount))

library(ggthemes)

ggplot(data = df, aes(x = reorder(State, bizCount), y = bizCount)) +
  theme_tufte() + 
  geom_bar(fill="gray38", stat = "identity",width = 0.8,) +  theme(axis.title=element_blank(),text = element_text(size=7)) +
  geom_hline(yintercept=seq(1, 800, 100), col="white", lwd=1) +
  coord_flip() + 
  labs(title = 'Number of Companies by State') +
  xlab('State') +
  ylab('Number of Companies')

```


## Question 2

Lets dig in on the state with the 3rd most companies in the data set. Imagine you work for the state and are interested in how many people are employed by companies in different industries. Create a plot that shows the average and/or median employment by industry for companies in this state (only use cases with full data, use R's `complete.cases()` function.) In addition to this, your graph should show how variable the ranges are, and you should deal with outliers.

##Looking at the Distributions by Industry
Using this we can see some different outliers that are out such in the Business and Product Services Industry there is an organization that has over 30000 employees
```{r}
inc <- inc[complete.cases(inc),]
ny = inc %>%
  filter(State == "NY")

g <- ggplot(ny, aes(reorder(Industry,Employees,mean), Employees))
g <- g + geom_boxplot() + coord_flip() + labs(x = "Industry", y = "Employees") + ggtitle("Employee Size Distribution of Different Industries")
g

g <- ny %>% filter(Employees < 5000) %>% ggplot(aes(reorder(Industry,Employees,mean), Employees))
g <- g + geom_boxplot() + coord_flip() + labs(x = "Industry", y = "Employees")+ggtitle("Employee Distribution of Companies under 5000 Employees")
g

```

## A look at the means and median employee counts by Industry
Here I plot the means and the medians by each industry so we can get a better sense of how big the average company of a specific industry is.
```{r}
df_ny <- inc %>% 
  filter(State == "NY") %>% 
  filter(complete.cases(.)) %>% 
  group_by(Industry) %>% 
  summarise(Mean = mean(Employees),
            Median = median(Employees)) %>% 
  gather(Statistic, Amount, Mean, Median)


ggplot(data = df_ny, aes(x= reorder(Industry,-Amount),Amount)) +
  geom_bar(stat = 'identity', aes(fill = Statistic), position = 'dodge') +
  scale_fill_manual(values = c('grey80', 'grey33'))+
  geom_hline(yintercept=seq(1, 1500, 100), col="white", lwd=0.5) +
  theme_tufte() +
  coord_flip()+ggtitle("State of New York Employee counts by Industry") +
  xlab("Industry") + ylab("Employees Per Company")


```


## Question 3

Now imagine you work for an investor and want to see which industries generate the most revenue per employee. Create a chart that makes this information clear. Once again, the distribution per industry should be shown.

```{r}
# Answer Question 3 here

Rev_By_Emp <- inc %>% 
  filter(State == "NY") %>% 
  filter(complete.cases(.)) %>% 
  mutate(RevPerEmp = (Revenue / Employees)/1000) %>% 
  group_by(Industry) %>% 
  summarise(Mean = mean(RevPerEmp))


ggplot(data = Rev_By_Emp, aes(x= reorder(Industry,-Mean),Mean)) +
  geom_bar(stat = 'identity') +
  theme_tufte()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  geom_hline(yintercept=seq(1, 9000, 1000), col="white", lwd=0.5) +
  ylab('Revenue/Employee in thousands $')+ggtitle("State of New York Revenue Per Employee by Industry") +
  xlab("Industry") + ylab("Revenue Per Employee")


Rev_By_Emp %>% filter(Industry != "Energy") %>% ggplot(aes(x= reorder(Industry,-Mean),Mean)) +
  geom_bar(stat = 'identity') +
  theme_tufte()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  geom_hline(yintercept=seq(1, 1000, 100), col="white", lwd=0.5) +
  ylab('Revenue/Employee in thousands $')+ggtitle("State of New York Revenue Per Employee by Industry excluding Energy") +
  xlab("Industry") + ylab("Revenue Per Employee")



```





### One interesting thing to look at would be cost by industry, because the energy sector has very high revenues but most likely very high operating costs not related to human resources. Whereas a industry like software has one of the lower revenues per employee but almost all of that industries costs are related to human resources. Just looking at revenue is very far from capturing the entire picture.




